#include <gtest/gtest.h>
#include "bytearray.hpp"
#include <string_view>
#include <base64.hpp>

using namespace std::literals;

TEST(Utils, Base64EncodeRaw)
{
    auto ba = "00112233445566778899AABBCCDDEEFF"_ba;

    auto answer = "ABEiM0RVZneImaq7zN3u/w=="sv;

    std::string result;

    UTILS_MODULE_NS::Base64::Encode(ba.container().data(), ba.container().size(), result);

    ASSERT_EQ(answer, result);
}

TEST(Utils, Base64EncodeRawReturn)
{
    auto ba = "00112233445566778899AABBCCDDEEFF"_ba;

    auto answer = "ABEiM0RVZneImaq7zN3u/w=="sv;

    ASSERT_EQ(
        answer,
        UTILS_MODULE_NS::Base64::Encode(ba.container().data(), ba.container().size())
    );
}

TEST(Utils, Base64EncodeBytearray)
{
    auto ba = "00112233445566778899AABBCCDDEEFF"_ba;

    auto answer = "ABEiM0RVZneImaq7zN3u/w=="sv;

    std::string result;

    UTILS_MODULE_NS::Base64::Encode(ba, result);

    ASSERT_EQ(answer, result);
}

TEST(Utils, Base64EncodeBytearrayReturn)
{
    auto ba = "00112233445566778899AABBCCDDEEFF"_ba;

    auto answer = "ABEiM0RVZneImaq7zN3u/w=="sv;

    ASSERT_EQ(answer, UTILS_MODULE_NS::Base64::Encode(ba));
}

TEST(Utils, Base64DecodeRaw)
{
    auto ba = "00112233445566778899AABBCCDDEEFF"_ba;

    auto answer = "ABEiM0RVZneImaq7zN3u/w=="sv;

    std::vector<std::byte> target;

    UTILS_MODULE_NS::Base64::Decode(answer.data(), answer.size(), target);

    ASSERT_EQ(ba.container(), target);
}

TEST(Utils, Base64DecodeRawReturn)
{
    auto ba = "00112233445566778899AABBCCDDEEFF"_ba;

    auto answer = "ABEiM0RVZneImaq7zN3u/w=="sv;


    ASSERT_EQ(ba.container(), UTILS_MODULE_NS::Base64::Decode<std::byte>(answer.data(), answer.size()));
}

TEST(Utils, Base64DecodeString)
{
    auto ba = "00112233445566778899AABBCCDDEEFF"_ba;

    auto answer = "ABEiM0RVZneImaq7zN3u/w=="s;

    std::vector<std::byte> target;

    UTILS_MODULE_NS::Base64::Decode(answer, target);

    ASSERT_EQ(ba.container(), target);
}

TEST(Utils, Base64DecodeStringReturn)
{
    auto ba = "00112233445566778899AABBCCDDEEFF"_ba;

    auto answer = "ABEiM0RVZneImaq7zN3u/w=="s;

    ASSERT_EQ(ba.container(), UTILS_MODULE_NS::Base64::Decode<std::byte>(answer));
}

TEST(Utils, Base64DecodeStringView)
{
    auto ba = "00112233445566778899AABBCCDDEEFF"_ba;

    auto answer = "ABEiM0RVZneImaq7zN3u/w=="sv;

    std::vector<std::byte> target;

    UTILS_MODULE_NS::Base64::Decode(answer, target);

    ASSERT_EQ(ba.container(), target);
}

TEST(Utils, Base64DecodeStringViewReturn)
{
    auto ba = "00112233445566778899AABBCCDDEEFF"_ba;

    auto answer = "ABEiM0RVZneImaq7zN3u/w=="sv;

    ASSERT_EQ(ba.container(), UTILS_MODULE_NS::Base64::Decode<std::byte>(answer));
}

TEST(Utils, Base64HugeTest)
{
    // Bytes vs Encoded
    std::vector< std::pair < bytearray<>, std::string_view > > tests = {
        {"650CB55A17E17C73E5E49F32E75772F8014A2DAE"_ba, "ZQy1WhfhfHPl5J8y51dy+AFKLa4="},
        {"E6BC52DCDA8714B62739414F95701DD4F6A38499"_ba, "5rxS3NqHFLYnOUFPlXAd1PajhJk="},
        {"1444EC367097C8C92322DDF243D7AA4828934236"_ba, "FETsNnCXyMkjIt3yQ9eqSCiTQjY="},
        {"0B1097F012AAB74B5E4BA4D8010AB27410E6B8B1"_ba, "CxCX8BKqt0teS6TYAQqydBDmuLE="},
        {"2C1691762C336C8AF7B6C29C06158C325B362D99"_ba, "LBaRdiwzbIr3tsKcBhWMMls2LZk="},
        {"1C5E03D5F716523AC13739A8641AC386EA357B7F"_ba, "HF4D1fcWUjrBNzmoZBrDhuo1e38="},
        {"A10F75F4C80C4D04B40B0D00FECA0C28BB6D5CF7"_ba, "oQ919MgMTQS0Cw0A/soMKLttXPc="},
        {"76420EBE807C581E965E9A34117368AB679C7FED"_ba, "dkIOvoB8WB6WXpo0EXNoq2ecf+0="},
        {"C8EB8943E9B16A9C2AC235688DC2A051FA7D79E7"_ba, "yOuJQ+mxapwqwjVojcKgUfp9eec="},
        {"112131DEC5899CBA6E9E91F70B280DCF24FCE8BA"_ba, "ESEx3sWJnLpunpH3CygNzyT86Lo="},
        {"DDC3BB2DE6DC96379E3A211A9B86F0AA2E674D0B"_ba, "3cO7LebcljeeOiEam4bwqi5nTQs="},
        {"7442F571921482D758F29682868D111ED49FFC64"_ba, "dEL1cZIUgtdY8paCho0RHtSf/GQ="},
        {"5DE7231D04CDE45C5C506554C5C0989E37EE7137"_ba, "XecjHQTN5FxcUGVUxcCYnjfucTc="},
        {"2F6C1732D1065D07332AD02DECAF221872E98500"_ba, "L2wXMtEGXQczKtAt7K8iGHLphQA="},
        {"8DE9140410EA156DD7FC9E8F3E5E5E4A9A9D2F17"_ba, "jekUBBDqFW3X/J6PPl5eSpqdLxc="},
        {"A5981BBC503272F6AF89917E4E6B9CD809FB4BD8"_ba, "pZgbvFAycvaviZF+Tmuc2An7S9g="},
        {"955ABC349053A180635F4F3B1908AEAF9B2A9706"_ba, "lVq8NJBToYBjX087GQiur5sqlwY="},
        {"B8885A85A0484297593CFB4D22D9385288FE0E11"_ba, "uIhahaBIQpdZPPtNItk4Uoj+DhE="},
        {"9F585E99AA0FED244E914D454A7946C54E99D1CB"_ba, "n1hemaoP7SROkU1FSnlGxU6Z0cs="},
        {"2DE3CC2480F39C5A96BE93EB24E9242AF30F5DC0"_ba, "LePMJIDznFqWvpPrJOkkKvMPXcA="},
        {"D3D89457C38F92410E6BF1E0A3197D780888E122"_ba, "09iUV8OPkkEOa/Hgoxl9eAiI4SI="},
        {"27055194D79C23555AC6F146A3A4A4F98858F41F"_ba, "JwVRlNecI1VaxvFGo6Sk+YhY9B8="},
        {"3581C1ADBC1D60AA6E7C64E9B1BAC4844116A6D9"_ba, "NYHBrbwdYKpufGTpsbrEhEEWptk="},
        {"4A66010C80B72923A5424B7F19C416B589B805C8"_ba, "SmYBDIC3KSOlQkt/GcQWtYm4Bcg="},
        {"9E4F624064755E053003E63308351DE938973B0A"_ba, "nk9iQGR1XgUwA+YzCDUd6TiXOwo="},
        {"F518FC852E1C66560B225B8C60AD968108870C67"_ba, "9Rj8hS4cZlYLIluMYK2WgQiHDGc="},
        {"4C0FE09D94688863ADFD85BF2CC4067A47B3B99C"_ba, "TA/gnZRoiGOt/YW/LMQGekezuZw="},
        {"ACF5A7AA3485045AF2B751A8D38C32A073BE34AA"_ba, "rPWnqjSFBFryt1Go04wyoHO+NKo="},
        {"96DA59818784433951DBCDD319E21DE77E3919B7"_ba, "ltpZgYeEQzlR283TGeId5345Gbc="},
        {"205B3094DD0D97D8AEDCF9837DD3E3DF24006EAF"_ba, "IFswlN0Nl9iu3PmDfdPj3yQAbq8="},
        {"7D96ADC49BF955766C11D5F2BBC37778A1310EEB"_ba, "fZatxJv5VXZsEdXyu8N3eKExDus="},
        {"19A82DC56E8910D3C9015FF90160EC9ABF5BE861"_ba, "GagtxW6JENPJAV/5AWDsmr9b6GE="},
        {"E6C480FE2E10F6E4D257C927A67B524366C8DC13"_ba, "5sSA/i4Q9uTSV8knpntSQ2bI3BM="},
        {"C04C8A9D0DA849831EA54E8DD37CE7897B2BD6FE"_ba, "wEyKnQ2oSYMepU6N03zniXsr1v4="},
        {"F9FA919C995308910C44521D277B842EBD589F9B"_ba, "+fqRnJlTCJEMRFIdJ3uELr1Yn5s="},
        {"493E853B5DA9B2951DD080DCDCFDE34397AECA3E"_ba, "ST6FO12pspUd0IDc3P3jQ5euyj4="},
        {"2C649ACACB42137040EBDDD5AF38C897E0EE8D42"_ba, "LGSaystCE3BA693VrzjIl+DujUI="},
        {"17AC025443C4328D56875656A48138F166E01AF1"_ba, "F6wCVEPEMo1Wh1ZWpIE48WbgGvE="},
        {"44DCB9922FFAFAEF41A4D98AA30447541B8748F6"_ba, "RNy5ki/6+u9BpNmKowRHVBuHSPY="},
        {"8B823715BB24353BE45E99412AD6426DF8E8B9F9"_ba, "i4I3FbskNTvkXplBKtZCbfjoufk="},
        {"7B7241B0481AF0FA65D3A025DABD563276765BA1"_ba, "e3JBsEga8Ppl06Al2r1WMnZ2W6E="},
        {"C8EB1036D64031F0EF9D9DF8AC71668F63B1F416"_ba, "yOsQNtZAMfDvnZ34rHFmj2Ox9BY="},
        {"69DB0717E17205D20F49A35D67CC792DD6BBC28E"_ba, "adsHF+FyBdIPSaNdZ8x5Lda7wo4="},
        {"805107CD85DB6936D9A32678412EBB1A6759F2B1"_ba, "gFEHzYXbaTbZoyZ4QS67GmdZ8rE="},
        {"B6C3A06F0349CCFAA11BA7BF45F389429D13C069"_ba, "tsOgbwNJzPqhG6e/RfOJQp0TwGk="},
        {"E612795F04386B54235F141DDF99FAB6735374B9"_ba, "5hJ5XwQ4a1QjXxQd35n6tnNTdLk="},
        {"19EB69A26E4C7F234BDDB8DAF1171F73933D413D"_ba, "Getpom5MfyNL3bja8Rcfc5M9QT0="},
        {"A775CA612F3976F4D02B8764C596751B22CBA392"_ba, "p3XKYS85dvTQK4dkxZZ1GyLLo5I="},
        {"03AC87C32E826798346DBF7DFC7617C8F7B595AA"_ba, "A6yHwy6CZ5g0bb99/HYXyPe1lao="},
        {"B7532FE7305E20A09F6921F434716584EDD566F4"_ba, "t1Mv5zBeIKCfaSH0NHFlhO3VZvQ="},
        {"D1B1F10A8985686A64DDAF2F6F12B7021B0E5CB4"_ba, "0bHxComFaGpk3a8vbxK3AhsOXLQ="},
        {"E5E2CCCB32057349960DB6E5085BEF8CF8AE5D27"_ba, "5eLMyzIFc0mWDbblCFvvjPiuXSc="},
        {"CA784213BBA5ABBD71919F46811FF21D01D47065"_ba, "ynhCE7ulq71xkZ9GgR/yHQHUcGU="},
        {"7F67349313ACABC9A456D3B26DCB6C8A3E9AD781"_ba, "f2c0kxOsq8mkVtOybctsij6a14E="},
        {"D8F04BA095B7FC7ACE60DA347927A462982EBDB7"_ba, "2PBLoJW3/HrOYNo0eSekYpguvbc="},
        {"CDB3557BEC7407B2B1883E8527A9F2A24496CA91"_ba, "zbNVe+x0B7KxiD6FJ6nyokSWypE="},
        {"E3E4CBB480FAD50C5DD98424E6B5EB2ACE970CAD"_ba, "4+TLtID61Qxd2YQk5rXrKs6XDK0="},
        {"04F07CEB77FCC2B9BFBD1DD51BE05FFF2FF4668C"_ba, "BPB863f8wrm/vR3VG+Bf/y/0Zow="},
        {"ABB37598D9F001CB41EE54077B0A37BABF2EFC69"_ba, "q7N1mNnwActB7lQHewo3ur8u/Gk="},
        {"66B98319AF9A0DE93D76DD367C240AA17C3ADBB4"_ba, "ZrmDGa+aDek9dt02fCQKoXw627Q="},
        {"4DD1BB54D77A8B679C3F6B0BF0BA414AE6EB1019"_ba, "TdG7VNd6i2ecP2sL8LpBSubrEBk="},
        {"770DC85FBB6BBF30845CEE74202C1ED932A4F2E4"_ba, "dw3IX7trvzCEXO50ICwe2TKk8uQ="},
        {"FD4F464B74BE8A0A0AB0977D2ED2E4E77154521C"_ba, "/U9GS3S+igoKsJd9LtLk53FUUhw="},
        {"35FB1CFBA8791E04C1B64F288DF9B87F8A52D21E"_ba, "Nfsc+6h5HgTBtk8ojfm4f4pS0h4="},
        {"DD3E1BF8ACA23CD800B0076D275851B07AEFF31C"_ba, "3T4b+KyiPNgAsAdtJ1hRsHrv8xw="},
        {"E23CEC75EFB3ADEA4CC7EFC9B90E6396650CD8A0"_ba, "4jzsde+zrepMx+/JuQ5jlmUM2KA="},
        {"A0AD4B63B94FE0DBFC1C29C928C209B1B83BCEC7"_ba, "oK1LY7lP4Nv8HCnJKMIJsbg7zsc="},
        {"25E93037F6A4186ED870EB20E1510AFC11D2A05A"_ba, "JekwN/akGG7YcOsg4VEK/BHSoFo="},
        {"B623720F7B0AC585333A1C108AF1FEA671DAFF92"_ba, "tiNyD3sKxYUzOhwQivH+pnHa/5I="},
        {"5602271650A778C1D1ECD7DAAF81CF6472E6C275"_ba, "VgInFlCneMHR7Nfar4HPZHLmwnU="},
        {"FA64CBF516E619ECB2803445DC063575EC0AC1D0"_ba, "+mTL9RbmGeyygDRF3AY1dewKwdA="},
        {"8A2A430468592D7218784A00DC50F625FDBC67A9"_ba, "iipDBGhZLXIYeEoA3FD2Jf28Z6k="},
        {"FE4072F54A10A0F6B087BA395A5A03284A84027F"_ba, "/kBy9UoQoPawh7o5WloDKEqEAn8="},
        {"2A746EEF367AC45D63C45EF7875B9A797AABAC5A"_ba, "KnRu7zZ6xF1jxF73h1uaeXqrrFo="},
        {"707BA31B20345C3533B0E2945ACB047EBDD6F6E2"_ba, "cHujGyA0XDUzsOKUWssEfr3W9uI="},
        {"09D857DA33D854AE57AD8B4B2D3A30C018D9E29D"_ba, "CdhX2jPYVK5XrYtLLTowwBjZ4p0="},
        {"2E366F16F8613EB69629CB1BD9B9370245F5D1F7"_ba, "LjZvFvhhPraWKcsb2bk3AkX10fc="},
        {"ECE278AC07E1E097123FC30E282532189451615C"_ba, "7OJ4rAfh4JcSP8MOKCUyGJRRYVw="},
        {"C919C5C094FAB04909BB006D5E6E04928399B802"_ba, "yRnFwJT6sEkJuwBtXm4EkoOZuAI="},
        {"CF689A62FD21EB6029873B6E69385DD1B0506B3C"_ba, "z2iaYv0h62AphztuaThd0bBQazw="},
        {"73C4C1CAFD89DA06214E53CB20C8829DF103F811"_ba, "c8TByv2J2gYhTlPLIMiCnfED+BE="},
        {"9672987A7100E22DA3E2E2D81610C2E309FDCA77"_ba, "lnKYenEA4i2j4uLYFhDC4wn9ync="},
        {"429806AD6674392CF95D4C83113C95A20DE0B054"_ba, "QpgGrWZ0OSz5XUyDETyVog3gsFQ="},
        {"C431CBC09ED4BE6C50488C4E15E11239888C5430"_ba, "xDHLwJ7UvmxQSIxOFeESOYiMVDA="},
        {"351D1BD25BB5EA46A5C8C4500322BEC40CF66E23"_ba, "NR0b0lu16kalyMRQAyK+xAz2biM="},
        {"8EC75DC9AEC2539702FA7F2076B3E35D336CED96"_ba, "jsddya7CU5cC+n8gdrPjXTNs7ZY="},
        {"8E1212D4D1924679EDC67D20C6E306F8AA79195B"_ba, "jhIS1NGSRnntxn0gxuMG+Kp5GVs="},
        {"FABA8ADA80E9286A958DB68EAA7A8A895A052247"_ba, "+rqK2oDpKGqVjbaOqnqKiVoFIkc="},
        {"8BDD11FF26A50230D575FC29105722508E6E3488"_ba, "i90R/yalAjDVdfwpEFciUI5uNIg="},
        {"C458117CD87355FF71DDD8124F5716D848E28C14"_ba, "xFgRfNhzVf9x3dgST1cW2EjijBQ="},
        {"A6BA21D725BE97E6F17FF360AB6A047838569E8E"_ba, "proh1yW+l+bxf/Ngq2oEeDhWno4="},
        {"7F177ACFF629F4E74BD1D6C1819C1A7F2A507396"_ba, "fxd6z/Yp9OdL0dbBgZwafypQc5Y="},
        {"E405183AA2E8CA0E596AAD27367CF4C3DA59A5C5"_ba, "5AUYOqLoyg5Zaq0nNnz0w9pZpcU="},
        {"266996EECF630BC5F8FA62B345B763F63BFFF9CC"_ba, "JmmW7s9jC8X4+mKzRbdj9jv/+cw="},
        {"9B8E18D8404B2A28145F68F32909C62C9624479B"_ba, "m44Y2EBLKigUX2jzKQnGLJYkR5s="},
        {"9B75363CD84CCCA125BEF5D8D5E9B663B280F51E"_ba, "m3U2PNhMzKElvvXY1em2Y7KA9R4="},
        {"98440F1D7CB2CAD3D67747B080B087FAE6DC9B6E"_ba, "mEQPHXyyytPWd0ewgLCH+ubcm24="},
        {"3FF06D65B7FDC6B6F446AB988D3494E07D0CF6AA"_ba, "P/BtZbf9xrb0RquYjTSU4H0M9qo="},
        {"75A7692FE8F527EFFC10181DB01D1E7274441CEF"_ba, "dadpL+j1J+/8EBgdsB0ecnREHO8="},
        {"25826495962FDA15FBA9C9A1A36B4108DC021EB8"_ba, "JYJklZYv2hX7qcmho2tBCNwCHrg="},
    };

    for (auto&& [bytes, base64] : tests)
    {
        ASSERT_EQ(UTILS_MODULE_NS::Base64::Encode(bytes), base64) << "Encoding of " << std::to_string(bytes) << " is not equal to " << base64;

        ASSERT_EQ(UTILS_MODULE_NS::Base64::Decode<std::byte>(base64), bytes.container()) << "Decoding of " << base64 << " is not equal to " << std::to_string(bytes);
    }
}